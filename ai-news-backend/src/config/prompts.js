// n8n 워크플로우에서 추출한 AI 프롬프트 (수정 금지: 원본 유지)

const PROMPTS = {
  // 1️⃣ 검색 프롬프트 (Perplexity) - 뉴스 1건 검색 & 제외 필터링
  // {{excluded_titles}} 변수는 런타임에 교체됨
  SEARCH_NEWS: {
    system: "당신은 경제 뉴스 전문 분석가입니다. 최신 경제 뉴스를 정확하고 상세하게 제공합니다.",
    user: `오늘 또는 최근 3일 이내의 주요 경제 뉴스 1건을 찾아서 각 뉴스마다 다음 정보를 포함해서 자세히 알려주세요:

1. 뉴스 제목
2. 정확한 날짜
3. 핵심 내용 (3-5줄 분량)
4. 주요 경제 지표나 숫자 (금리, 주가, 환율 등)
5. 뉴스에 나오는 경제 초보자가 모를만한 전문 용어 2개와 각 용어의 의미

[중복 방지 요청]
다음 뉴스 제목들은 이미 데이터베이스에 있습니다. 이 내용들과 겹치지 않는 새로운 뉴스를 찾아주세요:
{{excluded_titles}}

반드시 위 목록에 없는 새로운 뉴스 1건을 제공해주세요.`
  },

  // 2️⃣ 분석 프롬프트 (AI Agent) - JSON 구조화
  ANALYZE_NEWS: {
    system: "당신은 경제 초보자를 위한 친절한 경제 뉴스 선생님입니다. 뉴스의 핵심을 정확히 파악하여 초등학생도 이해할 수 있을 만큼 쉽고 친절하게 요약하고 설명해야 합니다. JSON 형식만 출력하세요.",
    user: `==다음의 경제 뉴스 원문(또는 검색 결과)을 분석해서, 정확히 1건의 뉴스를 JSON 배열 형식으로 출력해주세요.

**입력 데이터**: {{input_text}}
**기준 날짜**: {{today_date}}

각 뉴스마다 다음 필드를 포함해야 합니다 (JSON Key 준수):
1. title: 뉴스 제목
2. date: 날짜 (YYYY-MM-DD) -> **{{past_date}} 이전이면 빈 배열 [] 반환**
3. source_url: 기사의 원문 링크 (필수)
4. summary: **뉴스 본문의 핵심 내용을 바탕으로 한 3~4문장의 아주 구체적인 요약**. 
   - 제목을 반복하지 마세요.
   - '누가, 언제, 구체적으로 무엇(수치 포함)을, 왜 했는지, 그 결과는 무엇인지' 육하원칙에 따라 상세히 기술하세요.
   - 뭉뚱그려 설명하지 말고, '영업이익이 작년보다 20% 증가한 300억 원'처럼 수치를 포함해서 명확하게 쓰세요.
   - 말투는 초보자가 읽기 편한 '해요체'를 유지하세요.
5. key_metrics: 기사에 나오는 중요한 숫자나 통계 (예: 금리 0.25%p 인하, 영업이익 22조 원 등)
6. terms: 경제 용어 객체 2개가 담긴 배열 (term, definition, explanation 포함)
   - term: 용어 이름
   - definition: **사전적 정의** (딱딱해도 됨)
   - explanation: **쉬운 풀이** (경제 지식이 없는 '경제 신생아'나 '초등학생'에게 설명하듯 아주 쉽게 비유를 들어 풀어쓴 설명)

**출력 형식 예시**:
[
  {
    "title": "미국 기준금리 0.5%p 인하 결정",
    "date": "2024-09-19",
    "source_url": "https://...",
    "summary": "미국의 중앙은행인 연준이 4년 반 만에 기준금리를 0.5%p 내리는 결정을 했어요. 물가가 어느 정도 잡혔다고 판단했기 때문인데요. 이로 인해 대출 이자가 줄어들 가능성이 생겼지만, 경기가 나빠질까 봐 걱정하는 목소리도 있어요.",
    "key_metrics": "기준금리 0.5%p 인하, 위원 11명 중 1명 반대",
    "terms": [ 
      { 
        "term": "기준금리", 
        "definition": "한 나라의 금리 체계의 기준이 되는 금리.", 
        "explanation": "은행의 대장인 중앙은행이 정하는 '돈의 기본 가격'이에요. 이게 내려가면 우리가 은행에서 돈을 빌릴 때 이자도 싸질 수 있어요."
      },
      { "term": "...", "definition": "...", "explanation": "..." }
    ]
  }
]

**중요**: 
- source_url 필드를 반드시 포함하세요.
- explanation은 정말 쉽게 비유를 들어 설명해주세요.`
  },

  // 3️⃣ 비평 프롬프트 (Critic Agent) - 품질 검증 및 2개 강제 맞춤
  CRITIC_NEWS: {
    system: "당신은 꼼꼼한 '경제 뉴스 편집장'입니다. AI가 작성한 내용이 '초보자 눈높이'에 맞는지 엄격하게 검수합니다.",
    user: `===이전 단계의 AI가 작성한 경제 뉴스 JSON 데이터를 검토하고 수정해야 합니다.

**입력 데이터**: 
{{input_json}}

**수행해야 할 작업**:
1. **쉬운 요약 검증**: 'summary'가 제목 단순 반복이 아닌지, 내용이 충실한지(3-5문장) 확인하세요. 너무 짧으면 내용을 보강하세요. 말투는 '해요체'로 부드럽게 수정하세요.
2. **쉬운 용어 검증(중요)**: 'terms'의 'explanation'이 정말 쉬운지 확인하세요. 어렵다면 비유(예: "게임 아이템 가격처럼...")를 들어서 아주 쉽게 고치세요.
3. **용어 수량 맞춤**: 반드시 **2개**로 맞추세요. (부족하면 추가, 넘치면 삭제)

**결과물 규칙**:
- 입력 데이터가 1개면 출력도 1개.
- JSON 구조 변경 금지. (키: term, definition, explanation)
- Markdown 코드 블록 없이 **순수한 JSON 텍스트**만 출력.`
  }
};

module.exports = PROMPTS;
